<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout | PMS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-success px-4">
    <a class="navbar-brand fw-bold" href="#">ðŸ›’ PMS User</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="dashboard.html">Product List</a></li>
        <li class="nav-item"><a class="nav-link active" href="checkout.html">Checkout</a></li>
        <li class="nav-item"><a class="nav-link text-warning" href="#" onclick="logout()">Logout</a></li>
      </ul>
    </div>
  </nav>

  <!-- Checkout Summary -->
  <div class="container mt-5">
    <h2 class="mb-4 text-center">Checkout Summary</h2>
    <div id="checkoutContainer"></div>
    <div class="text-center mt-4">
      <button class="btn btn-success" onclick="placeOrder()">Place Order</button>
    </div>
  </div>

  <script>
    const API = "http://localhost:3000/products";

    function loadCheckout() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      fetch(API)
        .then(res => res.json())
        .then(products => {
          const selected = products.filter(p => cart.includes(p.id));
          let total = 0;
          const rows = selected.map(p => {
            total += p.price;
            return `<tr><td>${p.name}</td><td>â‚¹${p.price}</td></tr>`;
          }).join("");

          document.getElementById("checkoutContainer").innerHTML = selected.length
            ? `<table class="table table-bordered">
                <thead class="table-success"><tr><th>Product</th><th>Price</th></tr></thead>
                <tbody>${rows}<tr class="table-secondary fw-bold"><td>Total</td><td>â‚¹${total}</td></tr></tbody>
              </table>`
            : `<p class="text-center">Your cart is empty.</p>`;
        });
    }

    function placeOrder() {
      localStorage.removeItem("cart");
      alert("Order placed successfully!");
      window.location.href = "dashboard.html";
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      localStorage.removeItem("cart");
      window.location.href = "../login.html";
    }

    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!user || user.role !== "user") {
      alert("Access denied.");
      window.location.href = "../login.html";
    }

    loadCheckout();
  </script>
</body>
</html>
